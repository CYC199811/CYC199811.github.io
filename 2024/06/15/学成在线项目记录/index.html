<!DOCTYPE HTML>
<html lang="zh-CN">



<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Ekin Cheng&#39;Blog">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Ekin Cheng&#39;Blog</title>
    <link rel="icon" type="image/png" href="/CYC199811/CYC199811.github.io/favicon.png">

    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/css/my.css">

    <script src="/CYC199811/CYC199811.github.io/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/CYC199811/CYC199811.github.io/atom.xml" title="Ekin Cheng'Blog" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/CYC199811/CYC199811.github.io/" class="waves-effect waves-light">
                    
                    <img src="/CYC199811/CYC199811.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Ekin Cheng&#39;Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/CYC199811/CYC199811.github.io/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/CYC199811/CYC199811.github.io/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/CYC199811/CYC199811.github.io/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/CYC199811/CYC199811.github.io/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/CYC199811/CYC199811.github.io/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/CYC199811/CYC199811.github.io/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/CYC199811/CYC199811.github.io/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/CYC199811/CYC199811.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Ekin Cheng&#39;Blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/CYC199811/CYC199811.github.io/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/CYC199811/CYC199811.github.io/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/CYC199811/CYC199811.github.io/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/CYC199811/CYC199811.github.io/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/CYC199811/CYC199811.github.io/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/CYC199811/CYC199811.github.io/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/CYC199811/CYC199811.github.io/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/CYC199811/CYC199811.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/CYC199811/CYC199811.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/CYC199811/CYC199811.github.io/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title"></h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/CYC199811/CYC199811.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-06-15
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="学成在线项目记录"><a href="#学成在线项目记录" class="headerlink" title="学成在线项目记录"></a>学成在线项目记录</h1><h2 id="0-整体的一个代码模块框架"><a href="#0-整体的一个代码模块框架" class="headerlink" title="0.整体的一个代码模块框架"></a>0.整体的一个代码模块框架</h2><h2 id="内容管理模块"><a href="#内容管理模块" class="headerlink" title="内容管理模块"></a>内容管理模块</h2><h2 id="1-使用mybatis-plus-generator或者mybatis-generator生成代码模版"><a href="#1-使用mybatis-plus-generator或者mybatis-generator生成代码模版" class="headerlink" title="1.使用mybatis-plus-generator或者mybatis-generator生成代码模版"></a>1.使用mybatis-plus-generator或者mybatis-generator生成代码模版</h2><p>![image-20240615093232813](/Users/chengyuchun/Library/Application Support/typora-user-images/image-20240615093232813.png)</p>
<h3 id="1-配置pom文件，pom文件中引入依赖"><a href="#1-配置pom文件，pom文件中引入依赖" class="headerlink" title="1.配置pom文件，pom文件中引入依赖"></a>1.配置pom文件，pom文件中引入依赖</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mp 代码生成器 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-建一个java类，设置好服务器名和Mysql数据库表，其中表名要和数据库表名对应，"><a href="#2-建一个java类，设置好服务器名和Mysql数据库表，其中表名要和数据库表名对应，" class="headerlink" title="2.建一个java类，设置好服务器名和Mysql数据库表，其中表名要和数据库表名对应，"></a>2.建一个java类，设置好服务器名和Mysql数据库表，其中表名要和数据库表名对应，</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private static final String SERVICE_NAME = "content";</span><br><span class="line"></span><br><span class="line">    //数据库账号</span><br><span class="line">    private static final String DATA_SOURCE_USER_NAME  = "root";</span><br><span class="line">    //数据库密码</span><br><span class="line">    private static final String DATA_SOURCE_PASSWORD  = "163519@Cyc";</span><br><span class="line">    //生成的表</span><br><span class="line">    private static final String[] TABLE_NAMES = new String[]{</span><br><span class="line">//        "mq_message",</span><br><span class="line">//        "mq_message_history"</span><br><span class="line">          "course_base",</span><br><span class="line">          "course_market",</span><br><span class="line">          "course_teacher",</span><br><span class="line">          "course_category",</span><br><span class="line">          "teachplan",</span><br><span class="line">          "teachplan_media",</span><br><span class="line">          "course_publish",</span><br><span class="line">          "course_publish_pre"</span><br><span class="line"></span><br><span class="line">    };</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 数据库配置</span><br><span class="line">       DataSourceConfig dsc = new DataSourceConfig();</span><br><span class="line">       dsc.setDbType(DbType.MYSQL);</span><br><span class="line">       dsc.setUrl("jdbc:mysql://localhost:3306/xc402_" + SERVICE_NAME</span><br><span class="line">             + "?serverTimezone=UTC&amp;useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8");</span><br><span class="line">//     dsc.setDriverName("com.mysql.jdbc.Driver");</span><br><span class="line">       dsc.setDriverName("com.mysql.cj.jdbc.Driver");</span><br><span class="line">       dsc.setUsername(DATA_SOURCE_USER_NAME);</span><br><span class="line">       dsc.setPassword(DATA_SOURCE_PASSWORD);</span><br><span class="line">       mpg.setDataSource(dsc);</span><br></pre></td></tr></tbody></table></figure>





<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">package com.xuecheng.generator;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line">import com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line">import com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.po.TableFill;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line">import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * MyBatis-Plus 代码生成类</span><br><span class="line"> */</span><br><span class="line">public class ContentCodeGenerator {</span><br><span class="line"></span><br><span class="line">    // TODO 修改服务名以及数据表名</span><br><span class="line">    private static final String SERVICE_NAME = "content";</span><br><span class="line"></span><br><span class="line">    //数据库账号</span><br><span class="line">    private static final String DATA_SOURCE_USER_NAME  = "root";</span><br><span class="line">    //数据库密码</span><br><span class="line">    private static final String DATA_SOURCE_PASSWORD  = "163519@Cyc";</span><br><span class="line">    //生成的表</span><br><span class="line">    private static final String[] TABLE_NAMES = new String[]{</span><br><span class="line">//        "mq_message",</span><br><span class="line">//        "mq_message_history"</span><br><span class="line">          "course_base",</span><br><span class="line">          "course_market",</span><br><span class="line">          "course_teacher",</span><br><span class="line">          "course_category",</span><br><span class="line">          "teachplan",</span><br><span class="line">          "teachplan_media",</span><br><span class="line">          "course_publish",</span><br><span class="line">          "course_publish_pre"</span><br><span class="line"></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    // TODO 默认生成entity，需要生成DTO修改此变量</span><br><span class="line">    // 一般情况下要先生成 DTO类 然后修改此参数再生成 PO 类。</span><br><span class="line">    private static final Boolean IS_DTO = false;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">       // 代码生成器</span><br><span class="line">       AutoGenerator mpg = new AutoGenerator();</span><br><span class="line">       // 选择 freemarker 引擎，默认 Velocity</span><br><span class="line">       mpg.setTemplateEngine(new FreemarkerTemplateEngine());</span><br><span class="line">       // 全局配置</span><br><span class="line">       GlobalConfig gc = new GlobalConfig();</span><br><span class="line">       gc.setFileOverride(true);</span><br><span class="line">       //生成路径</span><br><span class="line">       gc.setOutputDir(System.getProperty("user.dir") + "/xuecheng-plus-generator/src/main/java");</span><br><span class="line">       gc.setAuthor("itcast");</span><br><span class="line">       gc.setOpen(false);</span><br><span class="line">       gc.setSwagger2(false);</span><br><span class="line">       gc.setServiceName("%sService");</span><br><span class="line">        gc.setBaseResultMap(true);</span><br><span class="line">        gc.setBaseColumnList(true);</span><br><span class="line"></span><br><span class="line">       if (IS_DTO) {</span><br><span class="line">          gc.setSwagger2(true);</span><br><span class="line">          gc.setEntityName("%sDTO");</span><br><span class="line">       }</span><br><span class="line">       mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">       // 数据库配置</span><br><span class="line">       DataSourceConfig dsc = new DataSourceConfig();</span><br><span class="line">       dsc.setDbType(DbType.MYSQL);</span><br><span class="line">       dsc.setUrl("jdbc:mysql://localhost:3306/xc402_" + SERVICE_NAME</span><br><span class="line">             + "?serverTimezone=UTC&amp;useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8");</span><br><span class="line">//     dsc.setDriverName("com.mysql.jdbc.Driver");</span><br><span class="line">       dsc.setDriverName("com.mysql.cj.jdbc.Driver");</span><br><span class="line">       dsc.setUsername(DATA_SOURCE_USER_NAME);</span><br><span class="line">       dsc.setPassword(DATA_SOURCE_PASSWORD);</span><br><span class="line">       mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">       // 包配置</span><br><span class="line">       PackageConfig pc = new PackageConfig();</span><br><span class="line">       pc.setModuleName(SERVICE_NAME);</span><br><span class="line">       pc.setParent("com.xuecheng");</span><br><span class="line"></span><br><span class="line">       pc.setServiceImpl("service.impl");</span><br><span class="line">       pc.setXml("mapper");</span><br><span class="line">       pc.setEntity("model.po");</span><br><span class="line">       mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       // 设置模板</span><br><span class="line">       TemplateConfig tc = new TemplateConfig();</span><br><span class="line">       mpg.setTemplate(tc);</span><br><span class="line"></span><br><span class="line">       // 策略配置</span><br><span class="line">       StrategyConfig strategy = new StrategyConfig();</span><br><span class="line">       strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">       strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">       strategy.setEntityLombokModel(true);</span><br><span class="line">       strategy.setRestControllerStyle(true);</span><br><span class="line">       strategy.setInclude(TABLE_NAMES);</span><br><span class="line">       strategy.setControllerMappingHyphenStyle(true);</span><br><span class="line">       strategy.setTablePrefix(pc.getModuleName() + "_");</span><br><span class="line">       // Boolean类型字段是否移除is前缀处理</span><br><span class="line">       strategy.setEntityBooleanColumnRemoveIsPrefix(true);</span><br><span class="line">       strategy.setRestControllerStyle(true);</span><br><span class="line"></span><br><span class="line">       // 自动填充字段配置</span><br><span class="line">       strategy.setTableFillList(Arrays.asList(</span><br><span class="line">             new TableFill("create_date", FieldFill.INSERT),</span><br><span class="line">             new TableFill("change_date", FieldFill.INSERT_UPDATE),</span><br><span class="line">             new TableFill("modify_date", FieldFill.UPDATE)</span><br><span class="line">       ));</span><br><span class="line">       mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">       mpg.execute();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="2-启动前端项目为什么在相同的环境条件下会失败？"><a href="#2-启动前端项目为什么在相同的环境条件下会失败？" class="headerlink" title="2.启动前端项目为什么在相同的环境条件下会失败？"></a>2.启动前端项目为什么在相同的环境条件下会失败？</h2><h3 id="1-Win和Mac电脑存在差异，自己现在对于Mac前端环境的配置还不是很熟悉"><a href="#1-Win和Mac电脑存在差异，自己现在对于Mac前端环境的配置还不是很熟悉" class="headerlink" title="1.Win和Mac电脑存在差异，自己现在对于Mac前端环境的配置还不是很熟悉"></a>1.Win和Mac电脑存在差异，自己现在对于Mac前端环境的配置还不是很熟悉</h3><h3 id="2-怎样进行配置？"><a href="#2-怎样进行配置？" class="headerlink" title="2.怎样进行配置？"></a>2.怎样进行配置？</h3><h4 id="1-去除前端项目的node-modules包"><a href="#1-去除前端项目的node-modules包" class="headerlink" title="1.去除前端项目的node_modules包"></a>1.去除前端项目的node_modules包</h4><h4 id="2-去除lockpakeage-json"><a href="#2-去除lockpakeage-json" class="headerlink" title="2.去除lockpakeage.json"></a>2.去除lockpakeage.json</h4><h4 id="3-npm-cache-clean-–force-命令去除npm缓存"><a href="#3-npm-cache-clean-–force-命令去除npm缓存" class="headerlink" title="3.npm cache clean –force 命令去除npm缓存"></a>3.npm cache clean –force 命令去除npm缓存</h4><p>这里会报警告，但是可以用 npm cache verify 查看是否清除</p>
<h4 id="4-重新用-cnpm-install-安装项目依赖-大部分网上用npm-install-但是我的安装不成功或者是很慢"><a href="#4-重新用-cnpm-install-安装项目依赖-大部分网上用npm-install-但是我的安装不成功或者是很慢" class="headerlink" title="4.重新用 cnpm install 安装项目依赖(大部分网上用npm install ,但是我的安装不成功或者是很慢)"></a>4.重新用 cnpm install 安装项目依赖(大部分网上用npm install ,但是我的安装不成功或者是很慢)</h4><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf node_modules package-<span class="keyword">lock</span>.json </span><br><span class="line"></span><br><span class="line">cnpm install</span><br></pre></td></tr></tbody></table></figure>



<h2 id="关于npm-install-g-cnpm-–registry-https-registry-npm-taobao-org系统汇报警告npm-ERR-code-CERT-HAS-EXPIRED：解决证书过期问题"><a href="#关于npm-install-g-cnpm-–registry-https-registry-npm-taobao-org系统汇报警告npm-ERR-code-CERT-HAS-EXPIRED：解决证书过期问题" class="headerlink" title="关于npm install -g cnpm –registry=https://registry.npm.taobao.org系统汇报警告npm ERR! code CERT_HAS_EXPIRED：解决证书过期问题"></a>关于npm install -g cnpm –registry=<a target="_blank" rel="noopener" href="https://registry.npm.taobao.org系统汇报警告npm/">https://registry.npm.taobao.org系统汇报警告npm</a> ERR! code CERT_HAS_EXPIRED：解决证书过期问题</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.<img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240621110213627.png" alt="image-20240621110213627" style="zoom:150%;"></h3><h2 id="3-树型表查询"><a href="#3-树型表查询" class="headerlink" title="3.树型表查询"></a>3.树型表查询</h2><h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">package com.xuecheng.content.service.impl;</span><br><span class="line"></span><br><span class="line">import com.xuecheng.content.mapper.CourseCategoryMapper;</span><br><span class="line">import com.xuecheng.content.model.dto.CourseCategoryTreeDto;</span><br><span class="line">import com.xuecheng.content.service.CourseCategoryService;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Mr.M</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @description TODO</span><br><span class="line"> * @date 2023/2/12 14:49</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Service</span><br><span class="line">public class CourseCategoryServiceImpl implements CourseCategoryService {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    CourseCategoryMapper courseCategoryMapper;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;CourseCategoryTreeDto&gt; queryTreeNodes(String id) {</span><br><span class="line">        //调用mapper递归查询出分类信息</span><br><span class="line">        List&lt;CourseCategoryTreeDto&gt; courseCategoryTreeDtos = courseCategoryMapper.selectTreeNodes(id);</span><br><span class="line"></span><br><span class="line">        //找到每个节点的子节点，最终封装成List&lt;CourseCategoryTreeDto&gt;</span><br><span class="line">        //先将list转成map，key就是结点的id，value就是CourseCategoryTreeDto对象，</span><br><span class="line">        // 目的就是为了方便从map获取结点,filter(item-&gt;!id.equals(item.getId()))把根结点排除</span><br><span class="line">        Map&lt;String, CourseCategoryTreeDto&gt; mapTemp = courseCategoryTreeDtos.stream().</span><br><span class="line">                filter(item -&gt; !id.equals(item.getId())).collect(Collectors.toMap(key -&gt; key.getId(), value -&gt; value, (key1, key2) -&gt; key2));</span><br><span class="line">        //定义一个list作为最终返回的list</span><br><span class="line">        List&lt;CourseCategoryTreeDto&gt; courseCategoryList = new ArrayList&lt;&gt;();</span><br><span class="line">        //从头遍历 List&lt;CourseCategoryTreeDto&gt; ，一边遍历一边找子节点放在父节点的childrenTreeNodes</span><br><span class="line">        courseCategoryTreeDtos.stream().filter(item -&gt; !id.equals(item.getId())).forEach(item -&gt; {</span><br><span class="line">            if (item.getParentid().equals(id)) {</span><br><span class="line">                courseCategoryList.add(item);</span><br><span class="line">            }</span><br><span class="line">            //找到节点的父节点</span><br><span class="line">            CourseCategoryTreeDto courseCategoryParent = mapTemp.get(item.getParentid());</span><br><span class="line">            if(courseCategoryParent!=null){</span><br><span class="line">                if(courseCategoryParent.getChildrenTreeNodes()==null){</span><br><span class="line">                    //如果该父节点的ChildrenTreeNodes属性为空要new一个集合，因为要向该集合中放它的子节点</span><br><span class="line">                    courseCategoryParent.setChildrenTreeNodes(new ArrayList&lt;CourseCategoryTreeDto&gt;());</span><br><span class="line">                }</span><br><span class="line">                //到每个节点的子节点放在父节点的childrenTreeNodes属性中</span><br><span class="line">                courseCategoryParent.getChildrenTreeNodes().add(item);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        return courseCategoryList;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="4-确保前端的参数和后端的数据一致性（统一校验的需求）"><a href="#4-确保前端的参数和后端的数据一致性（统一校验的需求）" class="headerlink" title="4.确保前端的参数和后端的数据一致性（统一校验的需求）"></a>4.确保前端的参数和后端的数据一致性（统一校验的需求）</h2><h3 id="1-在controller和service中都要保持一致"><a href="#1-在controller和service中都要保持一致" class="headerlink" title="1.在controller和service中都要保持一致"></a>1.在controller和service中都要保持一致</h3><h3 id="2-Service中根据业务规则去校验不方便写成通用代码，Controller中则可以将校验的代码写成通用代码。"><a href="#2-Service中根据业务规则去校验不方便写成通用代码，Controller中则可以将校验的代码写成通用代码。" class="headerlink" title="2.Service中根据业务规则去校验不方便写成通用代码，Controller中则可以将校验的代码写成通用代码。"></a>2.Service中根据业务规则去校验不方便写成通用代码，Controller中则可以将校验的代码写成通用代码。</h3><h3 id="3-首先在Base工程添加spring-boot-starter-validation的依赖"><a href="#3-首先在Base工程添加spring-boot-starter-validation的依赖" class="headerlink" title="3.首先在Base工程添加spring-boot-starter-validation的依赖"></a>3.首先在Base工程添加spring-boot-starter-validation的依赖</h3><h3 id="Java-org-springframework-boot-spring-boot-starter-validation"><a href="#Java-org-springframework-boot-spring-boot-starter-validation" class="headerlink" title="Java          org.springframework.boot       spring-boot-starter-validation   "></a>Java   <dependency>       <groupid>org.springframework.boot</groupid>       <artifactid>spring-boot-starter-validation</artifactid>   </dependency></h3><h3 id="在javax-validation-constraints包下有很多这样的校验注解，直接使用注解定义校验规则即可。"><a href="#在javax-validation-constraints包下有很多这样的校验注解，直接使用注解定义校验规则即可。" class="headerlink" title="在javax.validation.constraints包下有很多这样的校验注解，直接使用注解定义校验规则即可。"></a>在javax.validation.constraints包下有很多这样的校验注解，直接使用注解定义校验规则即可。</h3><h3 id="4-注解加在相关参数的DTO-响应前端数据的参数-类中"><a href="#4-注解加在相关参数的DTO-响应前端数据的参数-类中" class="headerlink" title="4.注解加在相关参数的DTO(响应前端数据的参数)类中"></a>4.注解加在相关参数的DTO(响应前端数据的参数)类中</h3><h3 id="下面是一些API注解的含义"><a href="#下面是一些API注解的含义" class="headerlink" title="下面是一些API注解的含义"></a>下面是一些API注解的含义</h3><img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240616223812751.png" alt="image-20240616223812751" style="zoom:150%;">

<h2 id="媒资管理模块"><a href="#媒资管理模块" class="headerlink" title="媒资管理模块"></a>媒资管理模块</h2><img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240617152921383.png" alt="image-20240617152921383" style="zoom:150%;">

<h2 id="1-项目使用Nacos作用服务发现中心和配置中心"><a href="#1-项目使用Nacos作用服务发现中心和配置中心" class="headerlink" title="1.项目使用Nacos作用服务发现中心和配置中心"></a>1.项目使用Nacos作用服务发现中心和配置中心</h2><h3 id="nacos启动"><a href="#nacos启动" class="headerlink" title="nacos启动"></a>nacos启动</h3><h3 id="1-进入bin目录下，输入以下命令启动-下面是我的目录"><a href="#1-进入bin目录下，输入以下命令启动-下面是我的目录" class="headerlink" title="1.进入bin目录下，输入以下命令启动  (下面是我的目录)"></a>1.进入bin目录下，输入以下命令启动  (下面是我的目录)</h3><p>/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/nacos-server-2.3.2/nacos/bin</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh startup.sh -m standalone</span><br></pre></td></tr></tbody></table></figure>

<p> 显示 nacos is starting with standalone 表示启动成功</p>
<h3 id="2-使用此地址进入界面，-http-127-0-0-1-8848-nacos-账号密码均为nacos"><a href="#2-使用此地址进入界面，-http-127-0-0-1-8848-nacos-账号密码均为nacos" class="headerlink" title="2.使用此地址进入界面，        http://127.0.0.1:8848/nacos/         账号密码均为nacos"></a>2.使用此地址进入界面，        <a target="_blank" rel="noopener" href="http://127.0.0.1:8848/nacos/">http://127.0.0.1:8848/nacos/</a>         账号密码均为nacos</h3><h3 id="3-在终端进入bin目录使用-sh-shutdown-sh-关闭nacos"><a href="#3-在终端进入bin目录使用-sh-shutdown-sh-关闭nacos" class="headerlink" title="3.在终端进入bin目录使用  sh shutdown.sh  关闭nacos"></a>3.在终端进入bin目录使用  sh shutdown.sh  关闭nacos</h3><h3 id="nacos配置"><a href="#nacos配置" class="headerlink" title="nacos配置"></a>nacos配置</h3><h3 id="1-添加pom依赖"><a href="#1-添加pom依赖" class="headerlink" title="1.添加pom依赖"></a>1.添加pom依赖</h3><p>父工程：</p>
<dependency>
   <groupid>com.alibaba.cloud</groupid>
   <artifactid>spring-cloud-alibaba-dependencies</artifactid>
   <version>${spring-cloud-alibaba.version}</version>
   <type>pom</type>
   <scope>import</scope>
 </dependency>

<p>其他的接口工程：</p>
<dependency>
   <groupid>com.alibaba.cloud</groupid>
   <artifactid>spring-cloud-starter-alibaba-nacos-discovery</artifactid>
 </dependency>

<h3 id="2-在接口工程的yaml文件添加配置信息"><a href="#2-在接口工程的yaml文件添加配置信息" class="headerlink" title="2.在接口工程的yaml文件添加配置信息"></a>2.在接口工程的yaml文件添加配置信息</h3><p>#微服务配置<br> spring:<br>  application:<br>   name: system-service<br>  cloud:<br>   nacos:<br>    server-addr: localhost:8848      #这里可以改成以后的服务器地址<br>    discovery:<br>     namespace: dev   #这里的dev要与nacos创建的对应<br>     group: xuecheng-plus-project</p>
<h3 id="3-启动项目"><a href="#3-启动项目" class="headerlink" title="3.启动项目"></a>3.启动项目</h3><img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240617160959962.png" alt="image-20240617160959962" style="zoom:200%;">

<h3 id="4-查看nacos"><a href="#4-查看nacos" class="headerlink" title="4.查看nacos"></a>4.查看nacos</h3><p><img src="/CYC199811/CYC199811.github.io/../../MyBlogs/source/_posts/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/image-20240617161125180.png" alt="image-20240617161125180"></p>
<h3 id="出现这样表示配置注册成功"><a href="#出现这样表示配置注册成功" class="headerlink" title="出现这样表示配置注册成功"></a>出现这样表示配置注册成功</h3><h2 id="2-配置content-service时为什么会失败？"><a href="#2-配置content-service时为什么会失败？" class="headerlink" title="2.配置content-service时为什么会失败？"></a>2.配置content-service时为什么会失败？</h2><h3 id="自己配置在nacos的数据库链接没有一一对应，导致项目的测试没有通过"><a href="#自己配置在nacos的数据库链接没有一一对应，导致项目的测试没有通过" class="headerlink" title="自己配置在nacos的数据库链接没有一一对应，导致项目的测试没有通过"></a>自己配置在nacos的数据库链接没有一一对应，导致项目的测试没有通过</h3><h2 id="3-配置优先级"><a href="#3-配置优先级" class="headerlink" title="3.配置优先级"></a>3.配置优先级</h2><img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240617204905597.png" alt="image-20240617204905597" style="zoom:150%;">

<p>引入配置文件的形式有：</p>
<p>1、以项目应用名方式引入</p>
<p>2、以扩展配置文件方式引入</p>
<p>3、以共享配置文件 方式引入</p>
<p>4、本地配置文件</p>
<h3 id="各配置文件-的优先级：项目应用名配置文件-扩展配置文件-共享配置文件-本地配置文件。"><a href="#各配置文件-的优先级：项目应用名配置文件-扩展配置文件-共享配置文件-本地配置文件。" class="headerlink" title="各配置文件 的优先级：项目应用名配置文件 > 扩展配置文件 > 共享配置文件 > 本地配置文件。"></a>各配置文件 的优先级：项目应用名配置文件 &gt; 扩展配置文件 &gt; 共享配置文件 &gt; 本地配置文件。</h3><h2 id="媒资管理模块-1"><a href="#媒资管理模块-1" class="headerlink" title="媒资管理模块"></a>媒资管理模块</h2><h2 id="1-使用minio搭建分布式文件系统"><a href="#1-使用minio搭建分布式文件系统" class="headerlink" title="1.使用minio搭建分布式文件系统"></a>1.使用minio搭建分布式文件系统</h2><h3 id="1-minio的启动"><a href="#1-minio的启动" class="headerlink" title="1.minio的启动"></a>1.minio的启动</h3><p> /opt/homebrew/opt/minio/bin/minio server –certs-dir=/opt/homebrew/etc/minio/certs –address=:9000 /opt/homebrew/var/minio</p>
<p>–certs-dir=        /opt/homebrew/etc/minio/certs  配置文件目录<br>–address=           :9000 使用的端口<br>                            /opt/homebrew/var/minio 存储数据目录</p>
<h2 id="2-minio的使用"><a href="#2-minio的使用" class="headerlink" title="2.minio的使用"></a>2.minio的使用</h2><h3 id="1-创连接的条件，账号密码，地址"><a href="#1-创连接的条件，账号密码，地址" class="headerlink" title="1.创连接的条件，账号密码，地址"></a>1.创连接的条件，账号密码，地址</h3><h3 id="代码：-1"><a href="#代码：-1" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class MinioTest {</span><br><span class="line"></span><br><span class="line">    MinioClient minioClient =</span><br><span class="line">            MinioClient.builder()</span><br><span class="line">                    .endpoint("http://192.168.31.107:9000")</span><br><span class="line">                    .credentials("minioadmin", "minioadmin")</span><br><span class="line">                    .build();</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-以上传文件为例，代码："><a href="#2-以上传文件为例，代码：" class="headerlink" title="2.以上传文件为例，代码："></a>2.以上传文件为例，代码：</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    public class MinioTest {</span><br><span class="line"></span><br><span class="line">    MinioClient minioClient =</span><br><span class="line">            MinioClient.builder()</span><br><span class="line">                    .endpoint("http://192.168.31.107:9000")</span><br><span class="line">                    .credentials("minioadmin", "minioadmin")</span><br><span class="line">                    .build();</span><br><span class="line">                    </span><br><span class="line">    @Test</span><br><span class="line">    public void test_upload() throws Exception {</span><br><span class="line"></span><br><span class="line">//        //通过扩展名得到媒体资源类型 mimeType</span><br><span class="line">//        //根据扩展名取出mimeType</span><br><span class="line">//        ContentInfo extensionMatch = ContentInfoUtil.findExtensionMatch(".mp4");</span><br><span class="line">//        String mimeType = MediaType.APPLICATION_OCTET_STREAM_VALUE;//通用mimeType，字节流</span><br><span class="line">//        if(extensionMatch!=null){</span><br><span class="line">//            mimeType = extensionMatch.getMimeType();</span><br><span class="line">//        }</span><br><span class="line"></span><br><span class="line">        //上传文件的参数信息</span><br><span class="line">        UploadObjectArgs uploadObjectArgs = UploadObjectArgs.builder()</span><br><span class="line">                .bucket("testbucket")//桶</span><br><span class="line">                .filename("/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/小母狗.mov") //指定本地文件路径</span><br><span class="line">              //                .object("1.mp4")//对象名 在桶下存储该文件</span><br><span class="line">                .object("小骚逼.mov")//对象名 放在子目录下</span><br><span class="line">             //   .contentType(mimeType)//设置媒体文件类型</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        //上传文件</span><br><span class="line">        minioClient.uploadObject(uploadObjectArgs);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="3-下载文件测试代码："><a href="#3-下载文件测试代码：" class="headerlink" title="3.下载文件测试代码："></a>3.下载文件测试代码：</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//查询文件 从minio中下载</span><br><span class="line">@Test</span><br><span class="line">public void test_getFile() throws Exception {</span><br><span class="line"></span><br><span class="line">    GetObjectArgs getObjectArgs = GetObjectArgs.builder().bucket("testbucket").object("小骚逼.mov").build();</span><br><span class="line">    //查询远程服务获取到一个流对象</span><br><span class="line">    FilterInputStream inputStream = minioClient.getObject(getObjectArgs);</span><br><span class="line">    //指定输出流</span><br><span class="line">    FileOutputStream outputStream = new FileOutputStream</span><br><span class="line">            (new File("/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/小骚逼.mov"));</span><br><span class="line">    IOUtils.copy(inputStream,outputStream);//将输入流拷贝到输出流</span><br><span class="line"></span><br><span class="line">    //校验文件的完整性对文件的内容进行md5</span><br><span class="line">    FileInputStream fileInputStream1 = new FileInputStream</span><br><span class="line">            (new File("/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/小母狗.mov"));</span><br><span class="line">    String source_md5 = DigestUtils.md5Hex(fileInputStream1);</span><br><span class="line">    FileInputStream fileInputStream = new FileInputStream(new File</span><br><span class="line">            ("/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/小骚逼.mov"));</span><br><span class="line">    String local_md5 = DigestUtils.md5Hex(fileInputStream);</span><br><span class="line">    if(source_md5.equals(local_md5)){</span><br><span class="line">        System.out.println("下载成功");</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="其中可以用流的拷贝进行下载"><a href="#其中可以用流的拷贝进行下载" class="headerlink" title="其中可以用流的拷贝进行下载"></a>其中可以用流的拷贝进行下载</h3><p>IOUtils.copy(inputStream,outputStream);//将输入流拷贝到输出流</p>
<h3 id="校验文件完整性则可以通过比较上传和下载的同一文件的MD5值是否相同来进行判断"><a href="#校验文件完整性则可以通过比较上传和下载的同一文件的MD5值是否相同来进行判断" class="headerlink" title="校验文件完整性则可以通过比较上传和下载的同一文件的MD5值是否相同来进行判断"></a>校验文件完整性则可以通过比较上传和下载的同一文件的MD5值是否相同来进行判断</h3><h3 id="注意不要传入远程流进行MD5计算，因为远程流不稳定"><a href="#注意不要传入远程流进行MD5计算，因为远程流不稳定" class="headerlink" title="*注意不要传入远程流进行MD5计算，因为远程流不稳定"></a>*注意不要传入远程流进行MD5计算，因为远程流不稳定</h3><h2 id="3-获取文件的名字"><a href="#3-获取文件的名字" class="headerlink" title="3.获取文件的名字"></a>3.获取文件的名字</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//存储普通文件   从配置文件获取名字</span><br><span class="line">@Value("${minio.bucket.files}")</span><br><span class="line">private String bucket_mediafiles;</span><br><span class="line"></span><br><span class="line">//存储视频</span><br><span class="line">@Value("${minio.bucket.videofiles}")</span><br><span class="line">private String bucket_video;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="1-可以根据类获取"><a href="#1-可以根据类获取" class="headerlink" title="1.可以根据类获取"></a>1.可以根据类获取</h3><h3 id="2-可以通过配置文件注入"><a href="#2-可以通过配置文件注入" class="headerlink" title="2.可以通过配置文件注入"></a>2.可以通过配置文件注入</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public UploadFileResultDto uploadFile(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath) {</span><br><span class="line"></span><br><span class="line">    //文件名</span><br><span class="line">    String filename = uploadFileParamsDto.getFilename();</span><br><span class="line">    //先得到扩展名</span><br><span class="line">    String extension = filename.substring(filename.lastIndexOf("."));</span><br><span class="line"></span><br><span class="line">    //得到mimeType</span><br><span class="line">    String mimeType = getMimeType(extension);</span><br><span class="line"></span><br><span class="line">    //子目录</span><br><span class="line">    String defaultFolderPath = getDefaultFolderPath();</span><br><span class="line">    //文件的md5值</span><br><span class="line">    String fileMd5 = getFileMd5(new File(localFilePath));</span><br><span class="line">    String objectName = defaultFolderPath+fileMd5+extension;</span><br><span class="line">    //上传文件到minio</span><br><span class="line">    boolean result = addMediaFilesToMinIO(localFilePath, mimeType, bucket_mediafiles, objectName);</span><br><span class="line">    if(!result){</span><br><span class="line">        XueChengPlusException.cast("上传文件失败");</span><br><span class="line">    }</span><br><span class="line">    //入库文件信息</span><br><span class="line">    MediaFiles mediaFiles = currentProxy.addMediaFilesToDb(companyId, fileMd5, uploadFileParamsDto, bucket_mediafiles, objectName);</span><br><span class="line">    if(mediaFiles==null){</span><br><span class="line">        XueChengPlusException.cast("文件上传后保存信息失败");</span><br><span class="line">    }</span><br><span class="line">    //准备返回的对象</span><br><span class="line">    UploadFileResultDto uploadFileResultDto = new UploadFileResultDto();</span><br><span class="line">    BeanUtils.copyProperties(mediaFiles,uploadFileResultDto);</span><br><span class="line"></span><br><span class="line">    return uploadFileResultDto;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="4-在媒资服务中因为存在多个日志-Class-path-contains-multiple-SLF4J-bindings-（类路径包含多个-SLF4J-绑定。）导致项目启动失败怎样解决？"><a href="#4-在媒资服务中因为存在多个日志-Class-path-contains-multiple-SLF4J-bindings-（类路径包含多个-SLF4J-绑定。）导致项目启动失败怎样解决？" class="headerlink" title="4.在媒资服务中因为存在多个日志 Class path contains multiple SLF4J bindings.（类路径包含多个 SLF4J 绑定。）导致项目启动失败怎样解决？"></a>4.在媒资服务中因为存在多个日志 Class path contains multiple SLF4J bindings.（类路径包含多个 SLF4J 绑定。）导致项目启动失败怎样解决？</h2><p><img src="/CYC199811/CYC199811.github.io/../../MyBlogs/source/_posts/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/image-20240618213839135.png" alt="image-20240618213839135"></p>
<p>SLF4J: Class path contains multiple SLF4J bindings.<br>SLF4J: Found binding in [jar:file:/Users/chengyuchun/Desktop/Java_Project/XCZX_Project/repository/io/mosip/registration/registration-libs/1.1.5.4/registration-libs-1.1.5.4.jar!/org/slf4j/impl/StaticLoggerBinder.class]<br>SLF4J: Found binding in [jar:file:/Users/chengyuchun/Desktop/Java_Project/XCZX_Project/repository/org/apache/logging/log4j/log4j-slf4j-impl/2.13.3/log4j-slf4j-impl-2.13.3.jar!/org/slf4j/impl/StaticLoggerBinder.class]</p>
<h3 id="1-找到相关的jar包-log4j-slf4j-impl-2-13-3-jar和-logback-classic-1-2-3-jar"><a href="#1-找到相关的jar包-log4j-slf4j-impl-2-13-3-jar和-logback-classic-1-2-3-jar" class="headerlink" title="1.找到相关的jar包 log4j-slf4j-impl-2.13.3.jar和 logback-classic-1.2.3.jar"></a>1.找到相关的jar包 log4j-slf4j-impl-2.13.3.jar和 logback-classic-1.2.3.jar</h3><h3 id="2-去掉多余的pom依赖"><a href="#2-去掉多余的pom依赖" class="headerlink" title="2.去掉多余的pom依赖"></a>2.去掉多余的pom依赖</h3><h3 id="3-Maven重新clean-和-compile"><a href="#3-Maven重新clean-和-compile" class="headerlink" title="3.Maven重新clean 和 compile"></a>3.Maven重新clean 和 compile</h3><h2 id="5-有数据操作的方法，并且有网络连接上传等存在时间不固定的情况"><a href="#5-有数据操作的方法，并且有网络连接上传等存在时间不固定的情况" class="headerlink" title="5.有数据操作的方法，并且有网络连接上传等存在时间不固定的情况"></a>5.有数据操作的方法，并且有网络连接上传等存在时间不固定的情况</h2><h3 id="我们将操作数据的方法缩短"><a href="#我们将操作数据的方法缩短" class="headerlink" title="我们将操作数据的方法缩短"></a>我们将操作数据的方法缩短</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">public UploadFileResultDto uploadFile(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath) {</span><br><span class="line"></span><br><span class="line">    //文件名</span><br><span class="line">    String filename = uploadFileParamsDto.getFilename();</span><br><span class="line">    //先得到扩展名</span><br><span class="line">    String extension = filename.substring(filename.lastIndexOf("."));</span><br><span class="line"></span><br><span class="line">    //得到mimeType</span><br><span class="line">    String mimeType = getMimeType(extension);</span><br><span class="line"></span><br><span class="line">    //子目录</span><br><span class="line">    String defaultFolderPath = getDefaultFolderPath();//根据年月日获取年月日分类的目录</span><br><span class="line">    //文件的md5值</span><br><span class="line">    String fileMd5 = getFileMd5(new File(localFilePath));</span><br><span class="line"></span><br><span class="line">    //子目录加上MD5值就是文件名字加上扩展名</span><br><span class="line">    String objectName = defaultFolderPath+fileMd5+extension;</span><br><span class="line">    //上传文件到minio</span><br><span class="line">    boolean result = addMediaFilesToMinIO(localFilePath, mimeType, bucket_mediafiles, objectName);</span><br><span class="line">    if(!result){</span><br><span class="line">        XueChengPlusException.cast("上传文件失败");</span><br><span class="line">    }</span><br><span class="line">    //入库文件信息</span><br><span class="line">    MediaFiles mediaFiles = currentProxy.addMediaFilesToDb(companyId, fileMd5, uploadFileParamsDto, bucket_mediafiles, objectName);</span><br><span class="line">    if(mediaFiles==null){</span><br><span class="line">        XueChengPlusException.cast("文件上传后保存信息失败");</span><br><span class="line">    }</span><br><span class="line">    //准备返回的对象</span><br><span class="line">    UploadFileResultDto uploadFileResultDto = new UploadFileResultDto();</span><br><span class="line">    BeanUtils.copyProperties(mediaFiles,uploadFileResultDto);</span><br><span class="line"></span><br><span class="line">    return uploadFileResultDto;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @description 将文件信息添加到文件表</span><br><span class="line"> * @param companyId  机构id</span><br><span class="line"> * @param fileMd5  文件md5值</span><br><span class="line"> * @param uploadFileParamsDto  上传文件的信息</span><br><span class="line"> * @param bucket  桶</span><br><span class="line"> * @param objectName 对象名称</span><br><span class="line"> * @return com.xuecheng.media.model.po.MediaFiles</span><br><span class="line"> * @author Mr.M</span><br><span class="line"> * @date 2022/10/12 21:22</span><br><span class="line"> */</span><br><span class="line">@Transactional</span><br><span class="line">public MediaFiles addMediaFilesToDb(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){</span><br><span class="line">    //将文件信息保存到数据库</span><br><span class="line">    MediaFiles mediaFiles = mediaFilesMapper.selectById(fileMd5);</span><br><span class="line">    if(mediaFiles == null){</span><br><span class="line">        mediaFiles = new MediaFiles();</span><br><span class="line">        BeanUtils.copyProperties(uploadFileParamsDto,mediaFiles);</span><br><span class="line">        //文件id</span><br><span class="line">        mediaFiles.setId(fileMd5);</span><br><span class="line">        //机构id</span><br><span class="line">        mediaFiles.setCompanyId(companyId);</span><br><span class="line">        //桶</span><br><span class="line">        mediaFiles.setBucket(bucket);</span><br><span class="line">        //file_path</span><br><span class="line">        mediaFiles.setFilePath(objectName);</span><br><span class="line">        //file_id</span><br><span class="line">        mediaFiles.setFileId(fileMd5);</span><br><span class="line">        //url</span><br><span class="line">        mediaFiles.setUrl("/"+bucket+"/"+objectName);</span><br><span class="line">        //上传时间</span><br><span class="line">        mediaFiles.setCreateDate(LocalDateTime.now());</span><br><span class="line">        //状态</span><br><span class="line">        mediaFiles.setStatus("1");</span><br><span class="line">        //审核状态</span><br><span class="line">        mediaFiles.setAuditStatus("002003");</span><br><span class="line">        //插入数据库</span><br><span class="line">        int insert = mediaFilesMapper.insert(mediaFiles);</span><br><span class="line">        if(insert&lt;=0){</span><br><span class="line">            log.debug("向数据库保存文件失败,bucket:{},objectName:{}",bucket,objectName);</span><br><span class="line">            return null;</span><br><span class="line">        }</span><br><span class="line">        return mediaFiles;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    return mediaFiles;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="通过将操作数据方法加上事务控制，-Autowired"><a href="#通过将操作数据方法加上事务控制，-Autowired" class="headerlink" title="通过将操作数据方法加上事务控制，@Autowired"></a>通过将操作数据方法加上事务控制，@Autowired</h3><h3 id="MediaFileService-currentProxy；"><a href="#MediaFileService-currentProxy；" class="headerlink" title="MediaFileService currentProxy；"></a>MediaFileService currentProxy；</h3><h3 id="注入非事务方法"><a href="#注入非事务方法" class="headerlink" title="注入非事务方法"></a>注入非事务方法</h3><p>addMediaFilesToDb</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MediaFiles mediaFiles = currentProxy.addMediaFilesToDb(companyId, fileMd5, uploadFileParamsDto, bucket_mediafiles, objectName);</span><br></pre></td></tr></tbody></table></figure>

<p>目前是在uploadFile方法上添加@Transactional，当调用uploadFile方法前会开启数据库事务，如果上传文件过程时间较长那么数据库的事务持续时间就会变长，这样数据库链接释放就慢，最终导致数据库链接不够用。</p>
<p>我们只将addMediaFilesToDb方法添加事务控制即可,uploadFile方法上的@Transactional注解去掉。</p>
<h2 id="6-关于分块大文件的目录，Mac不能直接使用分块的目录进行合并"><a href="#6-关于分块大文件的目录，Mac不能直接使用分块的目录进行合并" class="headerlink" title="6.关于分块大文件的目录，Mac不能直接使用分块的目录进行合并"></a>6.关于分块大文件的目录，Mac不能直接使用分块的目录进行合并</h2><p>java.lang.NumberFormatException: For input string: “.DS_Store”</p>
<h3 id="会导致合并失败，因为目录含有带其他的隐藏文件导致合成失败"><a href="#会导致合并失败，因为目录含有带其他的隐藏文件导致合成失败" class="headerlink" title="会导致合并失败，因为目录含有带其他的隐藏文件导致合成失败"></a>会导致合并失败，因为目录含有带其他的隐藏文件导致合成失败</h3><h2 id="7-视频格式转换"><a href="#7-视频格式转换" class="headerlink" title="7.视频格式转换"></a>7.视频格式转换</h2><h3 id="1-ffmpeg-i-input-filename-avi-c-v-copy-c-a-copy-y-output-filename-mp4"><a href="#1-ffmpeg-i-input-filename-avi-c-v-copy-c-a-copy-y-output-filename-mp4" class="headerlink" title="1.ffmpeg -i input_filename.avi -c:v copy -c:a copy -y output_filename.mp4"></a>1.ffmpeg -i input_filename.avi -c:v copy -c:a copy -y output_filename.mp4</h3><h3 id="2-ffmpeg-i-源文件位置-目标文件位置："><a href="#2-ffmpeg-i-源文件位置-目标文件位置：" class="headerlink" title="2.ffmpeg -i 源文件位置 目标文件位置："></a>2.ffmpeg -i 源文件位置 目标文件位置：</h3><h3 id="ffmpeg-i"><a href="#ffmpeg-i" class="headerlink" title="ffmpeg -i"></a>ffmpeg -i</h3><h3 id="Users-chengyuchun-Desktop-Java实战项目-XCZX-Project-MinIO-minio-data-t-test-avi"><a href="#Users-chengyuchun-Desktop-Java实战项目-XCZX-Project-MinIO-minio-data-t-test-avi" class="headerlink" title="/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/t/test.avi"></a>/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/t/test.avi</h3><h3 id="Users-chengyuchun-Desktop-Java实战项目-XCZX-Project-MinIO-minio-data-t-t-mp4"><a href="#Users-chengyuchun-Desktop-Java实战项目-XCZX-Project-MinIO-minio-data-t-t-mp4" class="headerlink" title="/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/t/t.mp4"></a>/Users/chengyuchun/Desktop/Java实战项目/XCZX_Project/MinIO/minio_data/t/t.mp4</h3><h2 id="分布式任务调度"><a href="#分布式任务调度" class="headerlink" title="分布式任务调度"></a>分布式任务调度</h2><h2 id="1-xxljob的idea启动"><a href="#1-xxljob的idea启动" class="headerlink" title="1.xxljob的idea启动"></a>1.xxljob的idea启动</h2><h3 id="1-从gethub下载对应的压缩包解压"><a href="#1-从gethub下载对应的压缩包解压" class="headerlink" title="1.从gethub下载对应的压缩包解压"></a>1.从gethub下载对应的压缩包解压</h3><h3 id="2-用idea打开包"><a href="#2-用idea打开包" class="headerlink" title="2.用idea打开包"></a>2.用idea打开包</h3><h3 id="3-将总pom文件的maven构建选项注释掉，因为idea自带了Maven"><a href="#3-将总pom文件的maven构建选项注释掉，因为idea自带了Maven" class="headerlink" title="3.将总pom文件的maven构建选项注释掉，因为idea自带了Maven"></a>3.将总pom文件的maven构建选项注释掉，因为idea自带了Maven</h3><h3 id="4-修改数据库的服务器链接以及账号密码，并连接数据库"><a href="#4-修改数据库的服务器链接以及账号密码，并连接数据库" class="headerlink" title="4.修改数据库的服务器链接以及账号密码，并连接数据库"></a>4.修改数据库的服务器链接以及账号密码，并连接数据库</h3><h3 id="5-修改日志目录-data-applogs-xxl-job-xxl-job-admin-log-变成-src-main-java-com-xxl-job-core-handler"><a href="#5-修改日志目录-data-applogs-xxl-job-xxl-job-admin-log-变成-src-main-java-com-xxl-job-core-handler" class="headerlink" title="5.修改日志目录/data/applogs/xxl-job/xxl-job-admin.log 变成 src/main/java/com/xxl/job/core/handler"></a>5.修改日志目录/data/applogs/xxl-job/xxl-job-admin.log 变成 src/main/java/com/xxl/job/core/handler</h3><h3 id="6-用-http-localhost-8080-xxl-job-admin-打开页面"><a href="#6-用-http-localhost-8080-xxl-job-admin-打开页面" class="headerlink" title="6.用 http://localhost:8080/xxl-job-admin 打开页面"></a>6.用 <a target="_blank" rel="noopener" href="http://localhost:8080/xxl-job-admin">http://localhost:8080/xxl-job-admin</a> 打开页面</h3><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="2-xxljob调度中心能启动但是任务运行不成功"><a href="#2-xxljob调度中心能启动但是任务运行不成功" class="headerlink" title="2.xxljob调度中心能启动但是任务运行不成功"></a>2.xxljob调度中心能启动但是任务运行不成功</h2><h3 id="1-可能根据的nacos配置文件有问题"><a href="#1-可能根据的nacos配置文件有问题" class="headerlink" title="1.可能根据的nacos配置文件有问题"></a>1.可能根据的nacos配置文件有问题</h3><h3 id="2-可能经过网关后地址变了，导致访问不到"><a href="#2-可能经过网关后地址变了，导致访问不到" class="headerlink" title="2.可能经过网关后地址变了，导致访问不到"></a>2.可能经过网关后地址变了，导致访问不到</h3><h3 id="3-将多余的文件去掉，可能包含了其他的相关记录导致执行器不能执行现在的任务调度"><a href="#3-将多余的文件去掉，可能包含了其他的相关记录导致执行器不能执行现在的任务调度" class="headerlink" title="3.将多余的文件去掉，可能包含了其他的相关记录导致执行器不能执行现在的任务调度"></a>3.将多余的文件去掉，可能包含了其他的相关记录导致执行器不能执行现在的任务调度</h3><p><img src="/CYC199811/CYC199811.github.io/../../MyBlogs/source/_posts/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/image-20240621082313948.png" alt="image-20240621082313948"></p>
<p><img src="/CYC199811/CYC199811.github.io/../../MyBlogs/source/_posts/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/image-20240621082348212.png" alt="image-20240621082348212"></p>
<h2 id="3-关于配置启动类"><a href="#3-关于配置启动类" class="headerlink" title="3.关于配置启动类"></a>3.关于配置启动类</h2><h3 id="主要依据配置文件的层数来写-带有小横杆的就是一层"><a href="#主要依据配置文件的层数来写-带有小横杆的就是一层" class="headerlink" title="主要依据配置文件的层数来写      带有小横杆的就是一层"></a>主要依据配置文件的层数来写      带有小横杆的就是一层</h3><img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240620145518145.png" alt="image-20240620145518145" style="zoom:200%;">

<p><img src="/CYC199811/CYC199811.github.io/../../MyBlogs/source/_posts/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/image-20240620145337433.png" alt="image-20240620145337433"></p>
<h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><h2 id="由于分布式任务调度中心是在虚拟机中联网执行的，不能保证任务调度的一致性，可能会挂掉末个分片式执行器，导致任务重新分配造成任务可能重复执行"><a href="#由于分布式任务调度中心是在虚拟机中联网执行的，不能保证任务调度的一致性，可能会挂掉末个分片式执行器，导致任务重新分配造成任务可能重复执行" class="headerlink" title="由于分布式任务调度中心是在虚拟机中联网执行的，不能保证任务调度的一致性，可能会挂掉末个分片式执行器，导致任务重新分配造成任务可能重复执行"></a>由于分布式任务调度中心是在虚拟机中联网执行的，不能保证任务调度的一致性，可能会挂掉末个分片式执行器，导致任务重新分配造成任务可能重复执行</h2><h2 id="常用的java模板引擎还有哪些？"><a href="#常用的java模板引擎还有哪些？" class="headerlink" title="常用的java模板引擎还有哪些？"></a>常用的java模板引擎还有哪些？</h2><p>Jsp、Freemarker、Thymeleaf 、Velocity 等。</p>
<p>本项目采用Freemarker作为模板引擎技术。</p>
<p>Freemarker官方地址：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/">http://freemarker.foofun.cn/</a></p>
<p>FreeMarker 是一款 <em>模板引擎</em>： 即一种基于模板和要改变的数据， 并用来生成输出文本(HTML网页，电子邮件，配置文件，源代码等)的通用工具。 它不是面向最终用户的，而是一个Java类库，是一款程序员可以嵌入他们所开发产品的组件。</p>
<h2 id="freemarker模版引擎"><a href="#freemarker模版引擎" class="headerlink" title="freemarker模版引擎"></a>freemarker模版引擎</h2><p>freemarker提供很多指令用于解析各种类型的数据模型，参考地址：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_directives.html">http://freemarker.foofun.cn/ref_directives.html</a></p>
<h2 id="部署nginx来访问这些静态资源"><a href="#部署nginx来访问这些静态资源" class="headerlink" title="部署nginx来访问这些静态资源"></a>部署nginx来访问这些静态资源</h2><h3 id="1-使用brew-info-nginx-找到nginx"><a href="#1-使用brew-info-nginx-找到nginx" class="headerlink" title="1.使用brew info nginx 找到nginx"></a>1.使用brew info nginx 找到nginx</h3><h3 id="2-将其中的端口号修改，因为idea中内置TomCat端口也是8080"><a href="#2-将其中的端口号修改，因为idea中内置TomCat端口也是8080" class="headerlink" title="2.将其中的端口号修改，因为idea中内置TomCat端口也是8080"></a>2.将其中的端口号修改，因为idea中内置TomCat端口也是8080</h3><h3 id="3-使用nginx来启动nginx或者brew-services-start-nginx-重启的命令是-brew-services-restart-nginx"><a href="#3-使用nginx来启动nginx或者brew-services-start-nginx-重启的命令是-brew-services-restart-nginx" class="headerlink" title="3.使用nginx来启动nginx或者brew services start nginx // 重启的命令是: brew services restart nginx"></a>3.使用nginx来启动nginx或者brew services start nginx // 重启的命令是: brew services restart nginx</h3><h3 id="4-ps-ef-grep-nginx-获取到nginx的进程号-注意是找到“nginx-master”的那个进程号"><a href="#4-ps-ef-grep-nginx-获取到nginx的进程号-注意是找到“nginx-master”的那个进程号" class="headerlink" title="4.ps -ef|grep nginx 获取到nginx的进程号, 注意是找到“nginx:master”的那个进程号"></a>4.ps -ef|grep nginx 获取到nginx的进程号, 注意是找到“nginx:master”的那个进程号</h3><p><strong>kill -QUIT 72 (从容的停止，即不会立刻停止)</strong></p>
<p><strong>Kill -TERM 72 （立刻停止）</strong></p>
<p><strong>Kill -INT 72 （和上面一样，也是立刻停止）</strong></p>
<h2 id="nginx的使用可以看这篇文章"><a href="#nginx的使用可以看这篇文章" class="headerlink" title="nginx的使用可以看这篇文章"></a>nginx的使用可以看这篇文章</h2><p><a target="_blank" rel="noopener" href="https://gist.github.com/Mioke/ae35fa333dee3b2ac137#file-nginx_config-md">https://gist.github.com/Mioke/ae35fa333dee3b2ac137#file-nginx_config-md</a></p>
<h2 id="nginx的前端部署可以看看这个"><a href="#nginx的前端部署可以看看这个" class="headerlink" title="nginx的前端部署可以看看这个"></a>nginx的前端部署可以看看这个</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7208765341408559160">https://juejin.cn/post/7208765341408559160</a></p>
<h3 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx</span><br><span class="line"></span><br><span class="line">#启动</span><br><span class="line">sudo sbin/nginx     #浏览器访问 127.0.0.1 测试是否成功启动</span><br><span class="line"></span><br><span class="line">#重启</span><br><span class="line">sudo sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line">#停止</span><br><span class="line">sudo sbin/nginx -s stop</span><br></pre></td></tr></tbody></table></figure>



<h2 id="总结nginx常见的配置"><a href="#总结nginx常见的配置" class="headerlink" title="总结nginx常见的配置"></a>总结nginx常见的配置</h2><p>server {</p>
<p>​        listen       80;</p>
<p>​        server_name  localhost; //服务器地址</p>
<p>​                location / {</p>
<p>​            root   html/xc-ui-pc-static-portal;</p>
<p>​            index  index.htm register.html sign.html;//写的是xc-ui-pc-static-portal级的html文件</p>
<p>​        }</p>
<p>}</p>
<h2 id="页面静态化的应用"><a href="#页面静态化的应用" class="headerlink" title="页面静态化的应用"></a>页面静态化的应用</h2><h3 id="1-使用场景"><a href="#1-使用场景" class="headerlink" title="1.使用场景"></a>1.使用场景</h3><p>当生成的页面很长一段时间不会发生改变的就可以用页面静态化</p>
<h3 id="2-页面静态化的使用（使用freemarker生成静态化页面）"><a href="#2-页面静态化的使用（使用freemarker生成静态化页面）" class="headerlink" title="2.页面静态化的使用（使用freemarker生成静态化页面）"></a>2.页面静态化的使用（使用freemarker生成静态化页面）</h3><p>1.将页面静态化上传到Minio(文件系统中进行保存)</p>
<p>2.通过nginx进行页面访问（nginx的并发量远远大于TomCat）</p>
<h2 id="熔断降级处理"><a href="#熔断降级处理" class="headerlink" title="熔断降级处理"></a>熔断降级处理</h2><p>微服务中难免存在服务之间的远程调用，比如：内容管理服务远程调用媒资服务的上传文件接口，当微服务运行不正常会导致无法正常调用微服务，此时会出现异常，如果这种异常不去处理可能导致雪崩效应。</p>
<p>微服务的雪崩效应表现在服务与服务之间调用，当其中一个服务无法提供服务可能导致其它服务也死掉，比如：服务B调用服务A，由于A服务异常导致B服务响应缓慢，最后B、C等服务都不可用，像这样由一个服务所引起的一连串的多个服务无法提供服务即是微服务的雪崩效应，如下图：</p>
<img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240624165743112.png" alt="image-20240624165743112" style="zoom:150%;">

<p>可以采用熔断、降级的方法去解决。</p>
<p>熔断降级的相同点都是为了解决微服务系统崩溃的问题，但它们是两个不同的技术手段，两者又存在联系。</p>
<p>熔断：</p>
<p>当下游服务异常而断开与上游服务的交互，它就相当于保险丝，下游服务异常触发了熔断，从而保证上游服务不受影响。</p>
<img src="../../MyBlogs/source/_posts/学成在线项目记录/image-20240624165924297.png" alt="image-20240624165924297" style="zoom:200%;">

<p>降级：</p>
<p>当下游服务异常触发熔断后，上游服务就不再去调用异常的微服务而是执行了降级处理逻辑，这个降级处理逻辑可以是本地一个单独的方法。 </p>
<img src="../../MyBlogs/source/_posts/学成在线项目记录/clip_image002.jpg" alt="img" style="zoom:200%;">

<p>两者都是为了保护系统，熔断是当下游服务异常时一种保护系统的手段，降级是熔断后上游服务处理熔断的方法。</p>
<h2 id="熔断降级处理的方法使用"><a href="#熔断降级处理的方法使用" class="headerlink" title="熔断降级处理的方法使用"></a>熔断降级处理的方法使用</h2><h3 id="项目使用Hystrix框架实现熔断、降级处理，在feign-dev-yaml中配置。"><a href="#项目使用Hystrix框架实现熔断、降级处理，在feign-dev-yaml中配置。" class="headerlink" title="项目使用Hystrix框架实现熔断、降级处理，在feign-dev.yaml中配置。"></a>项目使用Hystrix框架实现熔断、降级处理，在feign-dev.yaml中配置。</h3><h3 id="1、开启Feign熔断保护"><a href="#1、开启Feign熔断保护" class="headerlink" title="1、开启Feign熔断保护"></a>1、开启Feign熔断保护</h3><p>  YAML   feign:    hystrix:     enabled: true    circuitbreaker:     enabled: true  </p>
<h3 id="2、设置熔断的超时时间，为了防止一次处理时间较长触发熔断这里还需要设置请求和连接的超时时间，如下："><a href="#2、设置熔断的超时时间，为了防止一次处理时间较长触发熔断这里还需要设置请求和连接的超时时间，如下：" class="headerlink" title="2、设置熔断的超时时间，为了防止一次处理时间较长触发熔断这里还需要设置请求和连接的超时时间，如下："></a>2、设置熔断的超时时间，为了防止一次处理时间较长触发熔断这里还需要设置请求和连接的超时时间，如下：</h3><p>  Bash   hystrix:    command:     default:      execution:       isolation:        thread:         timeoutInMilliseconds:  30000 #熔断超时时间   ribbon:    ConnectTimeout: 60000 #连接超时时间    ReadTimeout: 60000 #读超时时间    MaxAutoRetries: 0 #重试次数    MaxAutoRetriesNextServer: 1 #切换实例的重试次数  </p>
<h3 id="3、定义降级逻辑"><a href="#3、定义降级逻辑" class="headerlink" title="3、定义降级逻辑"></a>3、定义降级逻辑</h3><h4 id="两种方法："><a href="#两种方法：" class="headerlink" title="两种方法："></a>两种方法：</h4><h5 id="1）fallback"><a href="#1）fallback" class="headerlink" title="1）fallback"></a>1）fallback</h5><p>  Java   @FeignClient(value =  “media-api”,configuration = MultipartSupportConfig.class,fallback =  MediaServiceClientFallback.class)   @RequestMapping(“/media”)   public interface MediaServiceClient{   …  </p>
<p>定义一个fallback类MediaServiceClientFallback，此类实现了MediaServiceClient接口。</p>
<p>第一种方法无法取出熔断所抛出的异常，第二种方法定义MediaServiceClientFallbackFactory 可以解决这个问题。</p>
<h5 id="2）fallbackFactory"><a href="#2）fallbackFactory" class="headerlink" title="2）fallbackFactory"></a>2）fallbackFactory</h5><p>第二种方法在FeignClient中指定fallbackFactory ，如下：</p>
<p>  Java   @FeignClient(value =  “media-api”,configuration =  MultipartSupportConfig.class,fallbackFactory =  MediaServiceClientFallbackFactory.class)  </p>
<p>定义MediaServiceClientFallbackFactory如下：</p>
<p>  Java   @Slf4j   @Component   public class MediaServiceClientFallbackFactory implements FallbackFactory<mediaserviceclient>  {     @Override     public MediaServiceClient  create(Throwable throwable) {       return new  MediaServiceClient(){         @Override         public String  uploadFile(MultipartFile upload, String objectName) {           //降级方法           log.debug(“调用媒资管理服务上传文件时发生熔断，异常信息:{}”,throwable.toString(),throwable);           return null;         }       };     }   }  </mediaserviceclient></p>
<h4 id="降级处理逻辑："><a href="#降级处理逻辑：" class="headerlink" title="降级处理逻辑："></a>降级处理逻辑：</h4><p>返回一个null对象，上游服务请求接口得到一个null说明执行了降级处理。</p>
<p>测试：</p>
<p>停止媒资管理服务或人为制造异常观察是否执行降级逻辑。</p>
<h2 id="关于elasticsearch索引同步问题"><a href="#关于elasticsearch索引同步问题" class="headerlink" title="关于elasticsearch索引同步问题"></a>关于elasticsearch索引同步问题</h2><h3 id="1、针对实时性非常高的场景需要满足数据的及时同步，可以同步调用，或使用Canal去实现。"><a href="#1、针对实时性非常高的场景需要满足数据的及时同步，可以同步调用，或使用Canal去实现。" class="headerlink" title="1、针对实时性非常高的场景需要满足数据的及时同步，可以同步调用，或使用Canal去实现。"></a>1、针对实时性非常高的场景需要满足数据的及时同步，可以同步调用，或使用Canal去实现。</h3><p>1）同步调用即在向MySQL写数据后远程调用搜索服务的接口写入索引，此方法简单但是耦合代码太高。</p>
<p>2）可以使用一个中间的软件canal解决耦合性的问题，但存在学习与维护成本。</p>
<p>canal主要用途是基于 MySQL 数据库增量日志解析，并能提供增量数据订阅和消费，实现将MySQL的数据同步到消息队列、Elasticsearch、其它数据库等，应用场景十分丰富。 </p>
<h3 id="2-针对实时性不高的情况"><a href="#2-针对实时性不高的情况" class="headerlink" title="2.针对实时性不高的情况"></a>2.针对实时性不高的情况</h3><p>1.可以使用mq或者任务调度</p>
<h2 id="Springcloud-Security整合JWT令牌"><a href="#Springcloud-Security整合JWT令牌" class="headerlink" title="Springcloud-Security整合JWT令牌"></a>Springcloud-Security整合JWT令牌</h2><h3 id="1-需要加依赖"><a href="#1-需要加依赖" class="headerlink" title="1.需要加依赖"></a>1.需要加依赖</h3><p>在内容管理服务的content-api工程中添加依赖</p>
<!--认证相关-->
 <dependency>
   <groupid>org.springframework.cloud</groupid>
   <artifactid>spring-cloud-starter-security</artifactid>
 </dependency>
 <dependency>
   <groupid>org.springframework.cloud</groupid>
   <artifactid>spring-cloud-starter-oauth2</artifactid>
 </dependency>



<h3 id="2-在内容管理服务的content-api工程中添加TokenConfig"><a href="#2-在内容管理服务的content-api工程中添加TokenConfig" class="headerlink" title="2.在内容管理服务的content-api工程中添加TokenConfig"></a>2.在内容管理服务的content-api工程中添加TokenConfig</h3><p>package com.xuecheng.content.config;</p>
<p> import org.springframework.context.annotation.Bean;<br> import org.springframework.context.annotation.Configuration;<br> import org.springframework.security.oauth2.provider.token.TokenStore;<br> import org.springframework.security.oauth2.provider.token.store.JwtAccessTokenConverter;<br> import org.springframework.security.oauth2.provider.token.store.JwtTokenStore;</p>
<p> /**<br> * @author Administrator<br> * @version 1.0<br> **/<br> @Configuration<br> public class TokenConfig {</p>
<p>   //jwt签名密钥,与认证服务保持一致<br>   private String SIGNING_KEY = “mq123”;</p>
<p>   @Bean<br>   public TokenStore tokenStore() {<br>     //JWT令牌存储方案<br>     return new JwtTokenStore(accessTokenConverter());<br>   }</p>
<p>   @Bean<br>   public JwtAccessTokenConverter accessTokenConverter() {<br>     JwtAccessTokenConverter converter = new JwtAccessTokenConverter();<br>     converter.setSigningKey(SIGNING_KEY);<br>     return converter;<br>   }</p>
<p>  /* @Bean<br>   public TokenStore tokenStore() {<br>     //使用内存存储令牌（普通令牌）<br>     return new InMemoryTokenStore();<br>   }*/<br> }</p>
<h3 id="3-添加资源服务配置"><a href="#3-添加资源服务配置" class="headerlink" title="3.添加资源服务配置"></a>3.添加资源服务配置</h3><p>package com.xuecheng.content.config;</p>
<p> import org.springframework.beans.factory.annotation.Autowired;<br> import org.springframework.context.annotation.Configuration;<br> import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;<br> import org.springframework.security.config.annotation.web.builders.HttpSecurity;<br> import org.springframework.security.config.http.SessionCreationPolicy;<br> import org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer;<br> import org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter;<br> import org.springframework.security.oauth2.config.annotation.web.configurers.ResourceServerSecurityConfigurer;<br> import org.springframework.security.oauth2.provider.token.TokenStore;</p>
<p> /**<br> * @author Administrator<br> * @version 1.0<br> **/<br> @Configuration<br> @EnableResourceServer<br> @EnableGlobalMethodSecurity(securedEnabled = true,prePostEnabled = true)<br> public class ResouceServerConfig extends ResourceServerConfigurerAdapter {</p>
<p>   //资源服务标识<br>   public static final String <em>RESOURCE_ID</em> = “xuecheng-plus”;</p>
<p>   @Autowired<br>   TokenStore tokenStore;</p>
<p>   @Override<br>   public void configure(ResourceServerSecurityConfigurer resources) {<br>     resources.resourceId(<em>RESOURCE_ID</em>)//资源 id<br>         .tokenStore(tokenStore)<br>         .stateless(true);<br>   }</p>
<p>   @Override<br>   public void configure(HttpSecurity http) throws Exception {<br>     http.csrf().disable()<br>         .authorizeRequests()<br>         .antMatchers(“/r/<strong>“,”/course/</strong>“).authenticated()//所有/r/**的请求必须认证通过<br>         .anyRequest().permitAll()<br>     ;<br>   }</p>
<p> }</p>
<p>根据配置可知/course/**开头的接口需要认证通过。</p>
<h2 id="有关事务管理-Transactional控制的方法，当非事务方法调用事务控制方法时，需要将"><a href="#有关事务管理-Transactional控制的方法，当非事务方法调用事务控制方法时，需要将" class="headerlink" title="有关事务管理@Transactional控制的方法，当非事务方法调用事务控制方法时，需要将"></a>有关事务管理@Transactional控制的方法，当非事务方法调用事务控制方法时，需要将</h2><h3 id="1-将自己注入成代理"><a href="#1-将自己注入成代理" class="headerlink" title="1.将自己注入成代理"></a>1.将自己注入成代理</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">WxAuthServiceImpl currentPorxy;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-在调用它的方法，保证远程访问不会出错"><a href="#2-在调用它的方法，保证远程访问不会出错" class="headerlink" title="2.在调用它的方法，保证远程访问不会出错"></a>2.在调用它的方法，保证远程访问不会出错</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 保存用户信息到数据库</span><br><span class="line">XcUser xcUser = currentPorxy.addWxUser(userinfo);</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line">import com.xuecheng.ucenter.mapper.XcUserMapper;</span><br><span class="line">import com.xuecheng.ucenter.mapper.XcUserRoleMapper;</span><br><span class="line">import com.xuecheng.ucenter.model.dto.AuthParamsDto;</span><br><span class="line">import com.xuecheng.ucenter.model.dto.XcUserExt;</span><br><span class="line">import com.xuecheng.ucenter.model.po.XcUser;</span><br><span class="line">import com.xuecheng.ucenter.model.po.XcUserRole;</span><br><span class="line">import com.xuecheng.ucenter.service.AuthService;</span><br><span class="line">import com.xuecheng.ucenter.service.WxAuthService;</span><br><span class="line">import org.springframework.beans.BeanUtils;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.http.HttpMethod;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.StandardCharsets;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Mr.M</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @description 微信扫码认证</span><br><span class="line"> * @date 2023/2/24 11:57</span><br><span class="line"> */</span><br><span class="line">@Service("wx_authservice")</span><br><span class="line">public class WxAuthServiceImpl implements AuthService, WxAuthService {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    XcUserMapper xcUserMapper;</span><br><span class="line">    @Autowired</span><br><span class="line">    XcUserRoleMapper xcUserRoleMapper;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    WxAuthServiceImpl currentPorxy;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Value("${weixin.appid}")</span><br><span class="line">    String appid;</span><br><span class="line">    @Value("${weixin.secret}")</span><br><span class="line">    String secret;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public XcUserExt execute(AuthParamsDto authParamsDto) {</span><br><span class="line">        //得到账号</span><br><span class="line">        String username = authParamsDto.getUsername();</span><br><span class="line">        //查询数据库</span><br><span class="line">        XcUser xcUser = xcUserMapper.selectOne(new LambdaQueryWrapper&lt;XcUser&gt;().eq(XcUser::getUsername, username));</span><br><span class="line">        if(xcUser == null){</span><br><span class="line">            throw new RuntimeException("用户不存在");</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        XcUserExt xcUserExt = new XcUserExt();</span><br><span class="line">        BeanUtils.copyProperties(xcUser, xcUserExt);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return xcUserExt;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public XcUser wxAuth(String code) {</span><br><span class="line">        //申请令牌</span><br><span class="line">        Map&lt;String, String&gt; access_token_map = getAccess_token(code);</span><br><span class="line">        //访问令牌</span><br><span class="line">        String access_token = access_token_map.get("access_token");</span><br><span class="line">        String openid = access_token_map.get("openid");</span><br><span class="line"></span><br><span class="line">        //携带令牌查询用户信息</span><br><span class="line">        Map&lt;String, String&gt; userinfo = getUserinfo(access_token, openid);</span><br><span class="line"></span><br><span class="line">        // 保存用户信息到数据库</span><br><span class="line">        XcUser xcUser = currentPorxy.addWxUser(userinfo);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return xcUser;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Transactional</span><br><span class="line">    public XcUser addWxUser(Map&lt;String,String&gt; userInfo_map){</span><br><span class="line">        String unionid = userInfo_map.get("unionid");</span><br><span class="line">        String nickname = userInfo_map.get("nickname");</span><br><span class="line">        //根据unionid查询用户信息</span><br><span class="line">        XcUser xcUser = xcUserMapper.selectOne(new LambdaQueryWrapper&lt;XcUser&gt;().eq(XcUser::getWxUnionid, unionid));</span><br><span class="line">        if(xcUser !=null){</span><br><span class="line">            return xcUser;</span><br><span class="line">        }</span><br><span class="line">        //向数据库新增记录</span><br><span class="line">        xcUser = new XcUser();</span><br><span class="line">        String userId= UUID.randomUUID().toString();</span><br><span class="line">        xcUser.setId(userId);//主键</span><br><span class="line">        xcUser.setUsername(unionid);</span><br><span class="line">        xcUser.setPassword(unionid);</span><br><span class="line">        xcUser.setWxUnionid(unionid);</span><br><span class="line">        xcUser.setNickname(nickname);</span><br><span class="line">        xcUser.setName(nickname);</span><br><span class="line">        xcUser.setUtype("101001");//学生类型</span><br><span class="line">        xcUser.setStatus("1");//用户状态</span><br><span class="line">        xcUser.setCreateTime(LocalDateTime.now());</span><br><span class="line">        //插入</span><br><span class="line">        int insert = xcUserMapper.insert(xcUser);</span><br><span class="line"></span><br><span class="line">        //向用户角色关系表新增记录</span><br><span class="line">        XcUserRole xcUserRole = new XcUserRole();</span><br><span class="line">        xcUserRole.setId(UUID.randomUUID().toString());</span><br><span class="line">        xcUserRole.setUserId(userId);</span><br><span class="line">        xcUserRole.setRoleId("17");//学生角色</span><br><span class="line">        xcUserRole.setCreateTime(LocalDateTime.now());</span><br><span class="line">        xcUserRoleMapper.insert(xcUserRole);</span><br><span class="line">        return xcUser;</span><br><span class="line"></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Docker-镜像加速配置"><a href="#Docker-镜像加速配置" class="headerlink" title="Docker 镜像加速配置"></a>Docker 镜像加速配置</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span><br><span class="line">{</span><br><span class="line">    "registry-mirrors": [</span><br><span class="line">       "https://docker.m.daocloud.io",</span><br><span class="line">        "https://dockerproxy.com",</span><br><span class="line">        "https://docker.mirrors.ustc.edu.cn",</span><br><span class="line">        "https://docker.nju.edu.cn",</span><br><span class="line">        "https://dockerhub.azk8s.cn",</span><br><span class="line">        "https://docker.mirrors.ustc.edu.cn",</span><br><span class="line">        "https://mirror.iscas.ac.cn"</span><br><span class="line">    ]</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></tbody></table></figure>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/CYC199811/CYC199811.github.io/about" rel="external nofollow noreferrer">Ekin Cheng</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://github.com/CYC199811/CYC199811.github.io/CYC199811/CYC199811.github.io/2024/06/15/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/">https://github.com/CYC199811/CYC199811.github.io/CYC199811/CYC199811.github.io/2024/06/15/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/CYC199811/CYC199811.github.io/about" target="_blank">Ekin Cheng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/CYC199811/CYC199811.github.io/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/CYC199811/CYC199811.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/CYC199811/CYC199811.github.io/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/CYC199811/CYC199811.github.io/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    
        <div class="disqus-card card" data-aos="fade-up">
    <div id="disqus_thread" class="card-content">
        <noscript>Please enable JavaScript to view the
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
    </div>
</div>

<script type="text/javascript">
    disqus_config = function () {
        this.page.url = 'https://github.com/CYC199811/CYC199811.github.io/2024/06/15/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/';
        this.page.identifier = '/CYC199811/CYC199811.github.io/2024/06/15/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/';
        this.page.title = '';
    };
    let disqus_shortname = '';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://blinkfox.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/CYC199811/CYC199811.github.io/2025/07/26/MoonTV%E9%83%A8%E7%BD%B2/">
                    <div class="card-image">
                        
                        
                        <img src="/CYC199811/CYC199811.github.io/medias/featureimages/15.jpg" class="responsive-img" alt="自建个人的MoonTV">
                        
                        <span class="card-title">自建个人的MoonTV</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-07-26
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/CYC199811/CYC199811.github.io/categories/github%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/" class="post-category">
                                    github开源项目
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/CYC199811/CYC199811.github.io/tags/github/">
                        <span class="chip bg-color">github</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/CYC199811/CYC199811.github.io/2024/05/18/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/">
                    <div class="card-image">
                        
                        
                        <img src="/CYC199811/CYC199811.github.io/medias/featureimages/0.jpg" class="responsive-img" alt="">
                        
                        <span class="card-title"></span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-05-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Ekin Cheng
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/CYC199811/CYC199811.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/CYC199811/CYC199811.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/CYC199811/CYC199811.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/CYC199811/CYC199811.github.io/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/CYC199811/CYC199811.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/CYC199811/CYC199811.github.io/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/CYC199811/CYC199811.github.io/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <span id="year">2019</span>
            <a href="/CYC199811/CYC199811.github.io/about" target="_blank">Ekin Cheng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/CYC199811/CYC199811.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:yuchuncheng915@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1635194004" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1635194004" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/CYC199811/CYC199811.github.io/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>




    <script src="/CYC199811/CYC199811.github.io/libs/materialize/materialize.min.js"></script>
    <script src="/CYC199811/CYC199811.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/CYC199811/CYC199811.github.io/libs/aos/aos.js"></script>
    <script src="/CYC199811/CYC199811.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/CYC199811/CYC199811.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/CYC199811/CYC199811.github.io/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/CYC199811/CYC199811.github.io/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/CYC199811/CYC199811.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/CYC199811/CYC199811.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

      <!-- 后面添加的樱花效果 -->
    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/source/js/sakura.js"><\/script>');
        }
    </script> 

</body>

</html>
